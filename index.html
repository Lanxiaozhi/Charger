<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />

  <title>城市电动汽车充电桩分布</title>
  <meta name="description" content="" />
  <meta name="author" content="damien" />

  <link rel="stylesheet" href="css/styles.css" type="text/css" />
  <link rel="stylesheet" type="text/css" href="css/loading_style.css">

  <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.css" rel="stylesheet">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.js"></script>
  <script src="https://cdn.bootcss.com/PapaParse/4.3.7/papaparse.min.js"></script>
  <script src="js/calculate.js"></script>
  <script src="js/e-smart-zoom-jquery.js"></script>

  <script>
    $(document).ready(function() {

      $('#imageFullScreen').smartZoom({'maxScale' : 8, 'containerClass':'zoomableContainer'});

      $('#topPositionMap,#leftPositionMap,#rightPositionMap,#bottomPositionMap').bind("click", moveButtonClickHandler);
      $('#zoomInButton,#zoomOutButton').bind("click", zoomButtonClickHandler);

      function zoomButtonClickHandler(e){
        var scaleToAdd = 0.8;
        if(e.target.id == 'zoomOutButton')
          scaleToAdd = -scaleToAdd;
        $('#imageFullScreen').smartZoom('zoom', scaleToAdd);
      }

      function moveButtonClickHandler(e){
        var pixelsToMoveOnX = 0;
        var pixelsToMoveOnY = 0;

        switch(e.target.id){
          case "leftPositionMap":
            pixelsToMoveOnX = 50;
            break;
          case "rightPositionMap":
            pixelsToMoveOnX = -50;
            break;
          case "topPositionMap":
            pixelsToMoveOnY = 50;
            break;
          case "bottomPositionMap":
            pixelsToMoveOnY = -50;
            break;
        }
        $('#imageFullScreen').smartZoom('pan', pixelsToMoveOnX, pixelsToMoveOnY);
      }

      $("#page").hide();

      Papa.parse('csv/density.csv', {
        download: true,
        complete: function(results) {
          var data = results.data, html;
          for(var i = 1, _l = data.length-1; i < _l; i++) {
            var item = data[i];
            square[i-1].longitude = item[1];
            square[i-1].latitude = item[2];
            square[i-1].kind = item[3];
            square[i-1].density = item[4];
          }
          Papa.parse('csv/charevent-2.csv', {
            download: true,
            complete: function(results) {
              var data = results.data, html;
              for(var i = 1, _l = data.length-1; i < _l; i++) {
                var item = data[i];
                event_2[i-1].gridID = item[1];
                event_2[i-1].startTime = item[4];
                event_2[i-1].eventDur = Math.ceil(item[5]/3600);
              }
            }
          });
          Papa.parse('csv/charevent-5.csv', {
            download: true,
            complete: function(results) {
              var data = results.data, html;
              for(var i = 1, _l = data.length-1; i < _l; i++) {
                var item = data[i];
                event_5[i-1].gridID = item[1];
                event_5[i-1].startTime = item[4];
                event_5[i-1].eventDur = Math.ceil(item[5]/3600);
              }
            }
          });
          Papa.parse('csv/charevent-10.csv', {
            download: true,
            complete: function(results) {
              var data = results.data, html;
              for(var i = 1, _l = data.length-1; i < _l; i++) {
                var item = data[i];
                event_10[i-1].gridID = item[1];
                event_10[i-1].startTime = item[4];
                event_10[i-1].eventDur = Math.ceil(item[5]/3600);
              }
              $('body').addClass('loaded');
              $('#loader-wrapper .load_title').remove();
            }
          });
        }
      });

      $("#calculate").click(function () {
        $("#input").hide();
        $("#header").hide();
        totalPile = $("#total").val();
        var rate = $("#rate").val();
        rate = Number(rate);
        for(var i=0;i<square.length;i++){
          pile[i] = Math.round(totalPile/square.length);
          quickPile[i] = Math.round(pile[i]*rate/(1+rate));
          slowPile[i] = pile[i] - quickPile[i];

        }
        //console.log(quickPile);
        //console.log(slowPile);
        calcPile();
        console.log(calcQuickRate());
        console.log(calcSlowRate());
        $("#page").show();
      });
    });
  </script>
</head>
<body>
<div id="page">
  <div id="pageContent">
    <div id="imgContainer">
      <img id="imageFullScreen" src="src/map.jpg"/>
    </div>
    <div id="positionButtonDiv">
      <p>缩放 :
        <span>
          <img id="zoomInButton" class="zoomButton" src="src/zoomIn.png" title="zoom in" alt="zoom in" />
          <img id="zoomOutButton" class="zoomButton" src="src/zoomout.png" title="zoom out" alt="zoom out" />
        </span>
      </p>
      <p>
        <span class="positionButtonSpan">
          <map name="positionMap" class="positionMapClass">
            <area id="topPositionMap" shape="rect" coords="20,0,40,20" title="move up" alt="move up"/>
            <area id="leftPositionMap" shape="rect" coords="0,20,20,40" title="move left" alt="move left"/>
            <area id="rightPositionMap" shape="rect" coords="40,20,60,40" title="move right" alt="move right"/>
            <area id="bottomPositionMap" shape="rect" coords="20,40,40,60" title="move bottom" alt="move bottom"/>
          </map>
          <img src="src/position.png" usemap="#positionMap" />
        </span>
      </p>
    </div>
  </div>
  <div style="padding: 570px 100px 10px;">
    <form>
      <div class="col-md-5 col-md-offset-2 col-sm-5 col-sm-offset-2 col-xs-5 col-xs-offset-2">
        <div class="input-group input-group-lg">
          <span class="input-group-addon">所选位置</span>
          <input type="text" class="form-control" style="text-align:center;" disabled="disabled" id="position" placeholder="">
        </div>
      </div>
      <div class="col-md-3 col-sm-3 col-xs-3">
        <div class="input-group input-group-lg">
          <span class="input-group-addon">序号</span>
          <input type="text" class="form-control" style="text-align:center;" disabled="disabled" id="order" placeholder="">
        </div>
      </div>
    </form>
    <div style="height:50px;"></div>
    <form>
      <div class="col-md-5 col-md-offset-2 col-sm-5 col-sm-offset-2 col-xs-5 col-xs-offset-2">
        <div class="input-group input-group-lg">
          <span class="input-group-addon">功效函数<br/>(快充/慢充)</span>
          <input type="text" class="form-control" style="text-align:center;" disabled="disabled" id="totalRate1" placeholder="">
          <input type="text" class="form-control" style="text-align:center;" disabled="disabled" id="totalRate2" placeholder="">
        </div>
      </div>
      <div class="col-md-3 col-sm-3 col-xs-3">
        <div class="input-group input-group-lg">
          <span class="input-group-addon">数量<br/>(快充/慢充)</span>
          <input type="text" class="form-control" style="text-align:center;" disabled="disabled" id="number1" placeholder="">
          <input type="text" class="form-control" style="text-align:center;" disabled="disabled" id="number2" placeholder="">
        </div>
      </div>
    </form>
  </div>
</div>
<div id="loader-wrapper">
  <div id="loader"></div>
  <div class="loader-section section-left"></div>
  <div class="loader-section section-right"></div>
  <div class="load_title">Loading...<br><span>V1.0.2</span></div>
</div>
<header id="header">
  <div id="headerContainer">
    <h1 style="color:white;">城市电动汽车充电桩分布</h1>
    <p class="pull-right" style="color:white;">V1.0.2 By Lanxiaozhi</p>
  </div>
</header>
<div id="input">
  <div style="padding: 150px 100px 10px;">
    <form>
      <div class="col-md-4 col-md-offset-4 col-sm-4 col-sm-offset-4 col-xs-4 col-xs-offset-4">
        <div class="input-group input-group-lg">
          <span class="input-group-addon">总数</span>
          <input type="text" class="form-control" style="text-align:center;"
                 onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                 onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" id="total" value="50000" placeholder="50000">
        </div>
      </div>
      <div style="height:50px;"></div>
      <div class="col-md-4 col-md-offset-4 col-sm-4 col-sm-offset-4 col-xs-4 col-xs-offset-4">
        <div class="input-group input-group-lg">
          <span class="input-group-addon">比例(快充:慢充)</span>
          <input type="text" class="form-control" style="text-align:center;" onkeyup="if(isNaN(value))execCommand('undo')"
                 onafterpaste="if(isNaN(value))execCommand('undo')" id="rate" placeholder="1" value="1">
        </div>
      </div>
      <div style="height:50px;"></div>
      <div class="col-md-4 col-md-offset-4 col-sm-4 col-sm-offset-4 col-xs-4 col-xs-offset-4">
        <div class="input-group input-group-lg">
          <span class="input-group-addon">电动汽车使用率</span>
          <select name="useRate" id="useRate" class="selectpicker show-tick form-control" style="text-align: center;" multiple data-live-search="false">
            <option value="0.02" selected>2%</option>
            <option value="0.05">5%</option>
            <option value="0.1">10%</option>
          </select>
        </div>
      </div>
    </form>
    <div style="height:150px;" id="spin"></div>
    <div class="col-md-4 col-md-offset-4 col-sm-4 col-sm-offset-4 col-xs-4 col-xs-offset-4" style="text-align: center;">
      <p>后台计算耗时可能较多，请耐心等待</p>
    </div>
    <form>
      <div class="col-md-4 col-md-offset-4 col-sm-4 col-sm-offset-4 col-xs-4 col-xs-offset-4">
        <button type="button" id="calculate" class="btn btn-primary btn-lg btn-block">
          <i class="fa fa-dashboard"></i> 计算
        </button>
      </div>
    </form>
  </div>
</div>

<footer>
</footer>

</body>
</html>
